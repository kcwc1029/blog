## 1. Computer Architecture

-   Q: What is Computer Architecture?
-   A: Computer Architecture = Instruction Set Architecture + Machine Organization
-   Instruction Set æ˜¯ä¸€å€‹ software å’Œ hardware ä¹‹é–“çš„ interfaceï¼Œ
    -   software ä¸éœ€è¦çŸ¥é“ hardware æ€éº¼å¯¦åšï¼Œåªéœ€è¦çŸ¥é“æœ‰æ€éº¼æ¨£çš„ instructionï¼Œå°±å¯ä»¥æ ¹æ“š instruction å»ç™¼å±• software
    -   hardware è¨­è¨ˆè€…ä¹Ÿä¸éœ€è¦çŸ¥é“æœ€å¾ŒæœƒåŸ·è¡Œå“ªäº›ç¨‹å¼ï¼Œåªéœ€è¦å»ºé€ å‡ºå¯ä»¥åŸ·è¡Œ instruction çš„ç¡¬é«”
-   Instruction Set å…¶å¯¦å°±æ˜¯æŒ‡ Assembly Language
-   Machine Organization æŒ‡çš„æ˜¯æ ¹æ“š instruction set ä¾†è¨­è¨ˆçš„ hardwareï¼Œä¹Ÿå¯ä»¥é€é software ä¾†åšæ¨¡æ“¬
-   Moore's law: æ¯ 18 å€‹æœˆï¼Œä¸€å€‹ chip ä¸Šçš„ transistor æ•¸ç›®å¯ä»¥ double

## 2. Computer Abstractions and Technology

-   æ¶æ§‹å¾å¤–åˆ°å…§
-   Application Softwareï¼ˆæ‡‰ç”¨ç¨‹å¼ï¼‰
    -   ä½ ç”¨ Cã€Pythonã€Java å¯«çš„ç¨‹å¼
    -   å°ä½¿ç”¨è€…å‹å¥½ï¼ŒæŠ½è±¡ç¨‹åº¦é«˜
-   System Softwareï¼ˆç³»çµ±è»Ÿé«”ï¼‰
    -   ç·¨è­¯å™¨ï¼ˆCompilerï¼‰ï¼šæŠŠç¨‹å¼è½‰æˆæ©Ÿå™¨èƒ½æ‡‚çš„èªè¨€ï¼ˆçµ„åˆèªè¨€/æ©Ÿå™¨ç¢¼ï¼‰
    -   ä½œæ¥­ç³»çµ±ï¼ˆOSï¼‰ï¼šç®¡ç†è¼¸å…¥è¼¸å‡ºã€è¨˜æ†¶é«”ã€æ’ç¨‹ç­‰ç­‰
-   Hardwareï¼ˆç¡¬é«”ï¼‰
    -   CPUã€è¨˜æ†¶é«”ã€ç£ç¢Ÿã€I/O æ§åˆ¶å™¨
    -   æ˜¯æ‰€æœ‰ç¨‹å¼åŸ·è¡Œçš„å¯¦é«”åŸºç¤

### 2.1. ç¨‹å¼çš„è½‰æ›æµç¨‹ï¼šå¾é«˜éšèªè¨€åˆ°æ©Ÿå™¨èªè¨€

ç¨‹å¼çš„ä¸‰å±¤è¡¨ç¤ºæ–¹å¼ï¼š

-   High-level languageï¼ˆé«˜éšèªè¨€ï¼‰
    -   ä¾‹å¦‚ï¼šC èªè¨€ swap() å‡½å¼
    -   ä½ å¹³å¸¸å¯«çš„ç¨‹å¼ç¢¼
-   Assembly languageï¼ˆçµ„åˆèªè¨€ï¼‰
    -   ä¾‹å¦‚ï¼šMIPS æŒ‡ä»¤ add, sub, lw, sw
    -   æ˜¯ä¸€ç¨®äººé¡å¯è®€çš„æ©Ÿå™¨ç¢¼è¡¨ç¤ºæ–¹å¼
-   Hardware representationï¼ˆæ©Ÿå™¨èªè¨€ï¼‰
    -   ç”¨ 0 èˆ‡ 1 è¡¨ç¤ºçš„äºŒé€²ä½ç¢¼
    -   CPU èƒ½åŸ·è¡Œçš„å”¯ä¸€èªè¨€
-   é€éç·¨è­¯å™¨å’Œçµ„è­¯å™¨ï¼ˆassemblerï¼‰ï¼Œç¨‹å¼å¾ C èªè¨€ âœ çµ„åˆèªè¨€ âœ æ©Ÿå™¨ç¢¼

## 3. Instruction set architecture

-   é›»è…¦æ¶æ§‹(computer Architecture) = Instruction Set Architecture (ISA) + Machine Organization(é›»è…¦å…§éƒ¨çš„ç¡¬é«”å¯¦ä½œç´°ç¯€)
-   Instruction Set Architectureï¼ˆISAï¼‰ æ˜¯è¦æ ¼
-   çµ„åˆèªè¨€æ˜¯ã€Œè¡¨ç¤ºæ–¹å¼ã€

### 3.1. å°‡ C è½‰æˆ assembly

![upgit_20250323_1742737215.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250323_1742737215.png)


### 3.2. MIPS åŸºæœ¬æŒ‡ä»¤
- load/store=> è¨˜æ†¶é«”å­˜å–
- é‹ç®—
- jumpã€branch
- floating point
- memoryç®¡ç†
- special


### 3.3. MIPS ä½”å­˜å™¨
- r0-r31é€šç”¨æš«å­˜å™¨
- PCï¼šCPUæ¥ä¸‹ä¾†è¦åšå“ªä¸€å€‹æŒ‡ä»¤
- HI/ LOï¼šé•·ä½å…ƒçš„ALUé‹ç®—


### 3.4. MIPS Register Convention:

| æš«å­˜å™¨ç·¨è™Ÿ  | åç¨±      | ç”¨é€”                               |
| ----------- | --------- | ---------------------------------- |
| **$0**      | `$zero`   | å¸¸æ•¸ 0ï¼ˆå›ºå®šç‚º 0ï¼Œä¸èƒ½æ›´æ”¹ï¼‰       |
| **$1**      | `$at`     | Assembler ä½¿ç”¨ï¼Œä¿ç•™ï¼ˆä¸è¦è‡ªå·±ç”¨ï¼‰ |
| **$2â€“$3**   | `$v0â€“$v1` | å‡½å¼å›å‚³å€¼ï¼ˆfunction resultsï¼‰     |
| **$4â€“$7**   | `$a0â€“$a3` | å‡½å¼åƒæ•¸ï¼ˆargumentsï¼‰              |
| **$8â€“$15**  | `$t0â€“$t7` | æš«å­˜å™¨ï¼ˆCaller savesï¼‰             |
| **$16â€“$23** | `$s0â€“$s7` | æš«å­˜å™¨ï¼ˆCallee savesï¼‰             |
| **$24â€“$25** | `$t8â€“$t9` | æš«å­˜å™¨ï¼ˆå»¶ä¼¸çš„ temporaryï¼‰         |
| **$26â€“$27** | `$k0â€“$k1` | ä¿ç•™çµ¦ä½œæ¥­ç³»çµ±ï¼ˆKernel ä½¿ç”¨ï¼‰      |
| **$28**     | `$gp`     | Global pointerï¼ˆå…¨åŸŸå€æ®µæŒ‡æ¨™ï¼‰     |
| **$29**     | `$sp`     | Stack pointerï¼ˆå †ç–ŠæŒ‡æ¨™ï¼‰          |
| **$30**     | `$fp`     | Frame pointerï¼ˆæ¡†æ¶æŒ‡æ¨™ï¼‰          |
| **$31**     | `$ra`     | Return addressï¼ˆå‡½å¼è¿”å›ä½å€ï¼‰     |

-   `$gp`ã€`$sp`ã€`$fp`
-   `$t0â€“$t9`ï¼Œç”±å‘¼å«è€…ä¿å­˜ï¼ˆCaller Savesï¼‰
-   `$s0â€“$s7`ï¼Œç”±è¢«å‘¼å«è€…ä¿å­˜ï¼ˆCallee Savesï¼‰
-   `$a0â€“$a3` & `$v0â€“$v1`ï¼šå‚³åƒæ•¸èˆ‡å›å‚³å€¼

#### 3.4.1. å‡½å¼å‘¼å«ä¿å­˜è¦å‰‡

| æš«å­˜å™¨é¡å‹     | èª°è¦ä¿å­˜ï¼Ÿ        | ä½¿ç”¨æ™‚æ©Ÿ      |
| --------- | ------------ | --------- |
| `$t0â€“$t9` | å‘¼å«è€…ï¼ˆCallerï¼‰  | æš«æ™‚ç”¨çš„è®Šæ•¸    |
| `$s0â€“$s7` | è¢«å‘¼å«è€…ï¼ˆCalleeï¼‰ | å‡½å¼ä¸­è¦ä¿ç•™ä¸Šä¸‹æ–‡ |
| `$a0â€“$a3` | å‘¼å«è€…æä¾›        | ç•¶æˆå‚³å…¥åƒæ•¸ç”¨   |
| `$v0â€“$v1` | è¢«å‘¼å«è€…çµ¦çµæœ      | ç•¶æˆå‚³å›å€¼ç”¨    |

### 3.5. mips register

-   çµ„åˆèªè¨€ä¸­çš„è®Šæ•¸ï¼Œå…¶å¯¦å°±æ˜¯æš«å­˜å™¨
-   ä½”å­˜å™¨æ˜¯ç¡¬é«”çš„ä¸€éƒ¨åˆ†ï¼Œé€Ÿåº¦æ¯”è¨˜æ†¶é«”å¿«å¾ˆå¤šå€ï¼ˆns vs Âµsï¼‰
-   ç·¨è­¯å™¨æœƒè‡ªå‹•å¹«ä½ æŠŠä¸­é–“é‹ç®—æš«å­˜åˆ°æš«å­˜å™¨ä¸­
-   æš«å­˜å™¨èƒ½æš«å­˜è®Šæ•¸ âœ é™ä½ memory æµé‡ï¼Œæå‡ç¨‹å¼å¯†åº¦èˆ‡æ•ˆç‡

```
f = (g + h) - (i + j);

add $t0, $s1, $s2   # t0 = g + h
add $t1, $s3, $s4   # t1 = i + j
sub $s0, $t0, $t1   # f = t0 - t1 = (g + h) - (i + j)
```

### 3.6. MIPS ä¸­çš„ Memory Operandsï¼ˆè¨˜æ†¶é«”é‹ç®—å…ƒï¼‰

-   MIPS è¦æ±‚æ¯å€‹ wordï¼ˆ32-bitï¼‰å¿…é ˆå­˜æ”¾åœ¨ã€Œ4 çš„å€æ•¸ã€ä½å€ä¸Šã€‚

#### 3.6.1. lw â†’ Load Wordï¼ˆå¾è¨˜æ†¶é«”è®€å…¥è³‡æ–™ï¼‰

```
lw $t0, 12($s0)

å¾ã€Œè¨˜æ†¶é«”ä½å€ = `$s0 + 12`ã€çš„ä½ç½®å–å‡º 32-bit çš„å€¼
æŠŠé€™å€‹å€¼æ”¾é€² `$t0`
```

![upgit_20250323_1742742205.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250323_1742742205.png)

#### 3.6.2. sw â†’ Store Wordï¼ˆå¾æš«å­˜å™¨å¯«å…¥è¨˜æ†¶é«”ï¼‰

```
sw $t0, 12($s0)

æŠŠ `$t0` çš„å…§å®¹ï¼ˆ32-bit æ•´æ•¸ï¼‰ï¼Œå­˜é€²è¨˜æ†¶é«”ä½å€(`$s0 + 12`) æŒ‡åˆ°çš„åœ°æ–¹
```

![upgit_20250323_1742742486.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250323_1742742486.png)

```
A[12] = h + A[8];

lw   $t0, 32($s3)     # å¾è¨˜æ†¶é«”å–å‡º A[8]ï¼Œæ”¾åˆ° $t0
add  $t0, $s2, $t0    # $t0 = h + A[8]  (h åœ¨ $s2)
sw   $t0, 48($s3)     # å°‡ $t0ï¼ˆçµæœï¼‰å¯«å› A[12]
```

### 3.7. Aligned

![upgit_20250323_1742743089.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250323_1742743089.png)

-   æ›´å¿«ï¼ˆæ•ˆèƒ½ï¼‰
-   æ›´ç°¡å–®ï¼ˆç¡¬é«”è¨­è¨ˆï¼‰
-   æ›´å®‰å…¨ï¼ˆä¸æœƒå‡ºéŒ¯ï¼‰

### 3.8. Endianness

-   Endianï¼ˆä½å…ƒçµ„åºï¼‰æ˜¯æŒ‡ã€Œå¤šä½å…ƒè³‡æ–™åœ¨è¨˜æ†¶é«”ä¸­å„²å­˜çš„é †åºã€ã€‚
    -   Endianness æ±ºå®šäº†ã€Œä¸€å€‹ word è£¡çš„æ¯å€‹ byte çš„å„²å­˜é †åºã€
-   MSBï¼ˆMost Significant Byte/Bitï¼‰ï¼šæœ€æœ‰æ„ç¾©çš„ä½å…ƒï¼ˆæˆ–ä½å…ƒçµ„ï¼‰ â†’ é€šå¸¸æ˜¯æ•¸å­—æœ€å¤§çš„éƒ¨åˆ†
-   LSBï¼ˆLeast Significant Byte/Bitï¼‰ï¼šæœ€æ²’æœ‰æ„ç¾©çš„ä½å…ƒï¼ˆæˆ–ä½å…ƒçµ„ï¼‰â†’ æ•¸å­—æœ€å°çš„éƒ¨åˆ†
- Big Endian
	-   MIPS ä½¿ç”¨
	-   MSB å„²å­˜åœ¨ä½ä½å€
	-   å°±åƒã€Œäººé¡çš„é–±è®€ç¿’æ…£ã€ï¼šå·¦åˆ°å³ï¼ˆå¤§çš„åœ¨å‰ï¼‰
- Little Endian
	-   Intel ä½¿ç”¨
	-   æœ€ä½æœ‰æ•ˆä½å…ƒçµ„ï¼ˆLSBï¼‰ æ“ºåœ¨æœ€å‰é¢ï¼ˆä½ä½å€ï¼‰

![upgit_20250327_1743069611.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250327_1743069611.png)


### 3.9. ç‚ºä»€éº¼æˆ‘å€‘è¦ä½¿ç”¨æš«å­˜å™¨ï¼Œä¸å…¨é è¨˜æ†¶é«”ï¼Ÿ

-   æš«å­˜å™¨é€Ÿåº¦å¿«ï¼ˆå°å³å¿«ï¼‰
-   æš«å­˜å™¨æ¯”è¼ƒéˆæ´»ï¼ŒMIPS ç®—è¡“æŒ‡ä»¤ï¼š
    -       ä¸€æ¬¡å¯ä»¥è®€å…©å€‹æš«å­˜å™¨ âœ é‹ç®— âœ å¯«ä¸€å€‹æš«å­˜å™¨
-   ä½†å­˜å–è¨˜æ†¶é«”åªèƒ½ï¼šä¸€æ¬¡è®€ or å¯«ä¸€ç­†è³‡æ–™ï¼ˆç„¡é‹ç®—ï¼‰

### 3.10. Constants

-   å¸¸æ•¸ï¼ˆä¾‹å¦‚ 1ã€5ã€10ã€-18ï¼‰åœ¨ç¨‹å¼è£¡å¾ˆå¸¸
-   æ‰€ä»¥ MIPS æ”¯æ´ å¸¸æ•¸ç›´æ¥å¯«é€²æŒ‡ä»¤è£¡ï¼ˆImmediate valueï¼‰

```
addi $29, $29, 4      # $s0 = $s1 + 10

$s0, $s1 æ˜¯æš«å­˜å™¨
10 æ˜¯ç«‹å³å€¼ï¼ˆimmediate valueï¼‰

slti $8, $18, 10      # å°æ–¼ 10
andi $29, $29, 6      # ä½å…ƒ AND
ori  $29, $29, 4      # ä½å…ƒ OR
```

### 3.11. The Constant Zero

-   zero æ˜¯ MIPS çš„ç¬¬ 0 è™Ÿæš«å­˜å™¨ï¼Œæ°¸é æ˜¯ 0
-   å®ƒçš„å€¼ ç„¡æ³•è¢«æ”¹è®Š
-   å¸¸ç”¨æƒ…æ³

```
ç§»å‹•æš«å­˜å™¨å€¼
add $t2, $s1, $zero   # $t2 = $s1

æ¸…é™¤å€¼
add $s1, $zero, $zero  # $s1 = 0
```

### 3.12. MIPS æŒ‡ä»¤æ ¼å¼

-   ä¸€æ¢ MIPS æŒ‡ä»¤æ˜¯ 32 ä½å…ƒï¼ˆbitsï¼‰ï¼Œ
-   æ‰€ä»¥æœƒæŠŠé€™ 32 bits åˆ†æˆå¹¾å€‹ æ¬„ä½ï¼ˆfieldï¼‰ï¼Œæ¯å€‹æ¬„ä½éƒ½æœ‰ç‰¹å®šåŠŸèƒ½ï¼Œè®“é›»è…¦çŸ¥é“é€™æ¢æŒ‡ä»¤çš„ç”¨é€”
-   é›–ç„¶å¯ä»¥æ¯ç¨®æŒ‡ä»¤å®šç¾©ä¸åŒæ¬„ä½ï¼Œä½† MIPS å¼·èª¿ç°¡å–®ï¼ˆsimplicityï¼‰
-   ä¸‰ç¨®æŒ‡ä»¤æ ¼å¼ï¼š

| æ ¼å¼é¡å‹     | ç”¨é€”                                                        | å‚™è¨»                  |
| ------------ | ----------------------------------------------------------- | --------------------- |
| **R-format** | ç”¨æ–¼**æš«å­˜å™¨æ“ä½œ**çš„æŒ‡ä»¤ï¼ˆå¦‚ `add`, `sub`ï¼‰                 | Register              |
| **I-format** | ç”¨æ–¼**ç«‹å³æ•¸ï¼ˆimmediateï¼‰**ã€é‚„æœ‰**`lw` / `sw` è¨˜æ†¶é«”æ“ä½œ** | Offset ä¹Ÿç®— immediate |
| **J-format** | ç”¨æ–¼**è·³èºï¼ˆjumpï¼‰**æŒ‡ä»¤                                    | Jump é¡åˆ¥             |

#### 3.12.1. R-Formatï¼ˆRegister formatï¼‰

| opcode | rs                         | rt                         | rd                                  | shamt                           | funct |
| ------ | -------------------------- | -------------------------- | ----------------------------------- | ------------------------------- | ----- |
| 6      | 5                          | 5                          | 5                                   | 5                               | 6     |
|        | ç¬¬ä¸€å€‹ä¾†æºæš«å­˜å™¨ï¼ˆsourceï¼‰ | ç¬¬äºŒå€‹ä¾†æºæš«å­˜å™¨ï¼ˆtargetï¼‰ | çµæœå„²å­˜çš„ç›®çš„æš«å­˜å™¨ï¼ˆdestinationï¼‰ | shift amountï¼Œç”¨åœ¨ä½ç§»ï¼ˆshiftï¼‰ |       |

```
çµ„åˆèµ·ä¾†çš„äºŒé€²ä½
000000 10001 10010 01000 00000 100000
â†’  0    2    3    2    4    0    2    0    # è½‰æ›æˆåå…­é€²ä½ï¼ˆæ¯ 4 ä½ä¸€çµ„ï¼‰
â†’ `0x02324020`
```

-   ç‚ºä»€éº¼ register æ¬„ä½æ˜¯ 5 bitsï¼Ÿ
    -   å› ç‚º MIPS æœ‰ **32 å€‹æš«å­˜å™¨**ï¼Œè€Œ 25=322^5 = 3225=32ï¼Œæ‰€ä»¥ç”¨ 5 bits å‰›å¥½å¯ä»¥ç·¨è™Ÿ 0â€“31ã€‚
-   shamt æ¬„ä½
    -   shamt æ˜¯ shift amountï¼Œåªç”¨åœ¨ä½ç§»ï¼ˆshiftï¼‰æŒ‡ä»¤ä¸Šã€‚
    -   å¦‚æœä¸æ˜¯ shift é¡å‹çš„æŒ‡ä»¤ï¼Œå®ƒæœƒè¨­æˆ 00000ã€‚

#### 3.12.2. I-Formatï¼ˆRegister formatï¼‰

| opcode | rs         | rt         | immediate |
| ------ | ---------- | ---------- | --------- |
| 6      | 5          | 5          | 16        |
|        | ä¾†æºæš«å­˜å™¨ | ç›®çš„æš«å­˜å™¨ |           |

-   I-Format å¯¦ä¾‹ä¸€ï¼ˆaddi æŒ‡ä»¤ï¼‰

```
addi $21, $22, -50

opcode   rs     rt     immediate
001000 10110 10101 1111111111001110
```

-   I-Format å¯¦ä¾‹äºŒï¼ˆ`lw` æŒ‡ä»¤ï¼‰

```
lw $t0, 1200($t1)

opcode   rs     rt     immediate
100011 01001 01000 0000010010110000

```

### 3.13. Stored Program Computers

![upgit_20250323_1742744615.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250323_1742744615.png)

-   æŒ‡ä»¤æ˜¯ binaryï¼Œè³‡æ–™ä¹Ÿæ˜¯ binaryï¼Œæ²’ä»€éº¼æœ¬è³ªå·®åˆ¥
-   ç¨‹å¼å¯ä»¥è‡ªå·±æ”¹å¯«è‡ªå·±æˆ–æ“ä½œå…¶ä»–ç¨‹å¼ï¼Œä¾‹å¦‚ç·¨è­¯å™¨å°±æ˜¯ä¸€ç¨®ç¨‹å¼è™•ç†ç¨‹å¼çš„ä¾‹å­ã€‚
-   ç·¨è­¯å¥½çš„ç¨‹å¼å¯ä»¥æ¬åˆ°åˆ¥å°æ©Ÿå™¨ä¸Šè·‘ï¼Œåªè¦å…©å°æœ‰ä¸€æ¨£çš„ ISAï¼ˆæŒ‡ä»¤é›†æ¶æ§‹ï¼‰ï¼Œä¾‹å¦‚éƒ½æ˜¯ MIPSã€ARMã€x86ã€‚

## 4. Bitwise Operations

| æ“ä½œï¼ˆOperationï¼‰   | C     | MIPS      |
| ------------------- | ----- | --------- |
| å·¦ç§»ï¼ˆShift Leftï¼‰  | <<    | sll       |
| å³ç§»ï¼ˆShift Rightï¼‰ | >>    | srl       |
| AND                 | &<br> | and, andi |
| OR                  | \|    | or, ori   |
| NOT                 | ~     | nor       |

-   ä½¿ç”¨ R-Format

| opcode | rs                         | rt                         | rd                                  | shamt                           | funct |
| ------ | -------------------------- | -------------------------- | ----------------------------------- | ------------------------------- | ----- |
| 6      | 5                          | 5                          | 5                                   | 5                               | 6     |
|        | ç¬¬ä¸€å€‹ä¾†æºæš«å­˜å™¨ï¼ˆsourceï¼‰ | ç¬¬äºŒå€‹ä¾†æºæš«å­˜å™¨ï¼ˆtargetï¼‰ | çµæœå„²å­˜çš„ç›®çš„æš«å­˜å™¨ï¼ˆdestinationï¼‰ | shift amountï¼Œç”¨åœ¨ä½ç§»ï¼ˆshiftï¼‰ |       |

```
sll $t2, $s0, 4

sllï¼šå·¦ç§»é‚è¼¯ã€‚
$t2ï¼šç›®æ¨™å¯„å­˜å™¨ï¼Œçµæœæœƒå¯«å…¥é€™è£¡ã€‚
$s0ï¼šæºå¯„å­˜å™¨ï¼ŒåŒ…å«è¦ç§»ä½çš„æ•¸æ“šã€‚
4ï¼šç§»ä½é‡ï¼Œç§»å‹• 4 ä½ã€‚
```

### 4.1. èˆ‰ä¾‹ï¼šå·¦ç§»é‚è¼¯ï¼ˆShift Left Logicalï¼‰ï¼Œè£œ 0

-   å‡è¨­å¯„å­˜å™¨ $t0 çš„å€¼æ˜¯ 0000 1010(åé€²ä½ 10)

```
sll $t0, $t0, 2

0000 1010 # åŸæ•¸æ“š
0010 1000 # å·¦ç§» 2 ä½å¾Œ => ç©ºå‡ºçš„ 2 ä½è£œ 0ï¼ˆ00ï¼‰
```

### 4.2. èˆ‰ä¾‹ï¼šå³ç§»é‚è¼¯ï¼ˆShift Right Logicalï¼‰ï¼Œè£œ 0

-   å‡è¨­å¯„å­˜å™¨ $t0 çš„å€¼æ˜¯ 0000 1010(åé€²ä½ 10)

```
srl $t0, $t0, 2

0000 1010 # åŸæ•¸æ“š
0000 0010 # å·¦ç§» 2 ä½å¾Œ => å·¦é‚Šç©ºå‡ºçš„ 2 ä½è£œ 0ï¼ˆ00ï¼‰
```

### 4.3. èˆ‰ä¾‹ï¼šå³ç§»ç®—è¡“ï¼ˆShift Right Arithmeticï¼‰ï¼Œè£œç¬¦è™Ÿä½

-   å‡è¨­å¯„å­˜å™¨ $t0 çš„å€¼æ˜¯ 0000 1010(åé€²ä½ 10)

```
sra $t0, $t0, 2

0000 1010 # åŸæ•¸æ“š
0010 1000 # å·¦ç§» 2 ä½å¾Œ => ç¬¦è™Ÿä½æ˜¯ 0ï¼ˆæ­£æ•¸ï¼‰ï¼Œæ‰€ä»¥å·¦é‚Šè£œ 0
```

### 4.4. AND é‹ç®—

```
å‡è¨­æœ‰ä¸‰å€‹å¯„å­˜å™¨
$t2: 0000 0000 0000 0000 0000 1101 1100 0000
$t1: 0000 0000 0000 0000 0000 1111 1100 0000
$t0: 0000 0000 0000 0000 0000 1100 0000 0000

and $t0, $t1, $t2 # è¨ˆç®— $t1 & $t2 ä¸¦å­˜åˆ° $t0

$t1: 0000 0000 0000 0000 0000 1111 1100 0000
$t2: 0000 0000 0000 0000 0000 1101 1100 0000
--------------------------------------------
$t0: 0000 0000 0000 0000 0000 1101 1100 0000
```

### 4.5. OR é‹ç®—

```
å‡è¨­æœ‰ä¸‰å€‹å¯„å­˜å™¨
$t2: 0000 0000 0000 0000 0000 1101 1100 0000
$t1: 0000 0000 0000 0000 0000 1111 1100 0000
$t0: 0000 0000 0000 0000 0000 1101 1100 0000

or $t0, $t1, $t2 # è¨ˆç®— $t1 | $t2 ä¸¦å­˜åˆ° $t0

$t1: 0000 0000 0000 0000 0000 1111 1100 0000
$t2: 0000 0000 0000 0000 0000 1101 1100 0000
--------------------------------------------
$t0: 0000 0000 0000 0000 0000 1111 1100 0000
```

### 4.6. NOT é‹ç®—

-   MIPS æ²’æœ‰ç›´æ¥çš„ NOT æŒ‡ä»¤ï¼Œè€Œæ˜¯ç”¨ nor ä¾†æ¨¡æ“¬ NOT

```
nor $t0, $t1, $zero

$t1: 0000 0000 0000 0000 0000 1111 1100 0000
$t0: 1111 1111 1111 1111 1111 0000 0011 1111
```

## 5. MIPS Decision Instructions

### 5.1. beqï¼ˆBranch if Equalï¼‰ï¼š

```
beq register1, register2, L1
# å¦‚æœ register1 ç­‰æ–¼ register2ï¼Œå‰‡è·³è½‰åˆ°æ¨™ç±¤ L1
# å°æ‡‰çš„é«˜ç´šèªè¨€ï¼šif (register1 == register2) goto L1;
```

### 5.2. bneï¼ˆBranch if Not Equalï¼‰ï¼š

```
bne register1, register2, L1
# å¦‚æœ register1 ä¸ç­‰æ–¼ register2ï¼Œå‰‡è·³è½‰åˆ°æ¨™ç±¤ L1
# å°æ‡‰çš„é«˜ç´šèªè¨€ï¼šif (register1 != register2) goto L1;
```

### 5.3. èˆ‰ä¾‹ï¼š

```
å‡è¨­ $s0 = 5ï¼Œ$s1 = 5

beq $s0, $s1, L1
# å› ç‚º $s0 ç­‰æ–¼ $s1ï¼ˆ5 == 5ï¼‰ï¼Œç¨‹å¼æœƒè·³è½‰åˆ°æ¨™ç±¤ L1ã€‚
```

```
å‡è¨­ $s0 = 5ï¼Œ$s1 = 3

bne $s0, $s1, L1
# å› ç‚º $s0 ä¸ç­‰æ–¼ $s1ï¼ˆ5 != 3ï¼‰ï¼Œç¨‹å¼æœƒè·³è½‰åˆ°æ¨™ç±¤ L1ã€‚
```

## 6. MIPS Goto Instruction

### 6.1. jï¼ˆJumpï¼‰

-   j labelï¼šç›´æ¥è·³è½‰åˆ°æ¨™ç±¤ labelï¼Œä¸éœ€è¦æª¢æŸ¥ä»»ä½•æ¢ä»¶ã€‚
-   j æŒ‡ä»¤ä½¿ç”¨ J-type æŒ‡ä»¤æ ¼å¼

| op   | address               |
| ---- | --------------------- |
| 6 ä½ | 26 ä½(ç›®æ¨™æ¨™ç±¤çš„åœ°å€) |

### 6.2. Compiling C if into MIPS

| f   | g   | h   | i   | j   |
| --- | --- | --- | --- | --- |
| $s0 | $s1 | $s2 | $s3 | $s4 |

```
# C
if (i == j) f = g + h;
else f = g - h;


# è½‰æ›æˆmips
	bne $s3, $s4, Else
	add $s0, $s1, $s2
	j Exit
Else: sub $s0, $s1, $s2
Exit:
```

### 6.3. Compiling Loop Statement

```
# C
while (save[i] == k) i += 1;

i åœ¨ $s3
k åœ¨ $s5
save é™£åˆ—çš„åŸºåœ°å€åœ¨ $s6

# è½‰æ›æˆmips
Loop: sll $t1, $s3, 2     # å°‡ $s3 çš„å€¼å·¦ç§» 2 ä½ï¼Œçµæœå­˜åˆ° $t1 => åªæ˜¯å»é‹ç®—offset
	add $t1, $t1, $s6     # $t1=addr of save[i] (é™£åˆ—å¾0å»åç§»)
	lw $t0, 0($t1)        # $t0=save[i]
	bne $t0, $s5, Exit    # if save[i]!=k goto Exit
	addi $s3, $s3, 1      # i=i+1
	j Loop                # goto Loop
Exit:
```

## 7. basic block
- Basic block æ˜¯ä¸€çµ„é€£çºŒçš„æŒ‡ä»¤ï¼Œä¸¦æ»¿è¶³
	- ä¸­é–“æ²’æœ‰åˆ†æ”¯ï¼ˆbranchï¼‰æŒ‡ä»¤ï¼ˆé™¤äº†æœ€å¾Œä¸€æ¢æŒ‡ä»¤å¯ä»¥æ˜¯åˆ†æ”¯ï¼‰
	- ä¸­é–“ä¹Ÿä¸æœƒæ˜¯ä»»ä½•è·³è½‰ï¼ˆbranch targetï¼‰çš„ç›®çš„åœ°ï¼ˆåªèƒ½å¾é–‹é ­é€²å…¥ï¼‰
=> ä¸€é€²ä¾†ï¼Œå°±åªèƒ½å¾é ­è·‘åˆ°å°¾ï¼Œä¸­é–“ä¸èƒ½è·³é€²ä¾†æˆ–è·³å‡ºå»ã€‚

ç·¨è­¯å™¨ï¼ˆcompilerï¼‰ å¯ä»¥æ ¹æ“š Basic Blocks åš æœ€ä½³åŒ–ï¼ˆoptimizationï¼‰
è™•ç†å™¨ï¼ˆprocessorï¼‰ å¯ä»¥æ›´æœ‰æ•ˆç‡åœ°åŸ·è¡Œé€™æ¨£çš„å€å¡Šï¼Œå› ç‚ºä¸éœ€è¦ä¸€ç›´æª¢æŸ¥è·³è½‰æ¢ä»¶

![upgit_20250327_1743072234.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250327_1743072234.png)

## 8. inequalities in MIPS
- åœ¨MIPSä¸­ï¼Œæ¯”è¼ƒå¤§å°ï¼Œæ˜¯ä½œç‚ºä¸€å€‹æŒ‡ä»¤(ä½†ä¸åƒbeqå¯ä»¥è·³åˆ°å…¶ä»–ä½ç½®)
- å¯ä»¥é€éã€æ¯”è¼ƒå®Œå¤§å°çš„çµæœã€‘æ”¾åˆ°ä¸€å€‹ä½”å­˜å™¨ï¼Œç„¶å¾Œå†å»åšå…¶ä»–äº‹

### 8.1. set on less than
```
slt $rd $rs $rt
å¦‚æœ$rs<$rtï¼Œ$rdç‚º1ï¼Œå¦å‰‡ç‚º0
```

```
slti $rt $rs constant
å¦‚æœ$rs<constantï¼Œ$rtç‚º1ï¼Œå¦å‰‡ç‚º0
```

```
# C
if(g<h) goto Less
ä»¤g=$s0, h=$s1

# è½‰æ›ç‚ºMIPS
slt $t0 $s0 $s1
bne $t0 $0, Less
```
### 8.2. signedè·Ÿunsigned æ¯”è¼ƒ
- å°æ–¼æœ‰è™Ÿæ•¸ï¼šsltã€slti
- å°æ–¼ç„¡è™Ÿæ•¸ï¼šsltuã€sltui
```
$s0 = 1111...1111ï¼ˆå…¨éƒ¨æ˜¯ 1ï¼‰â†’ ç•¶æˆ æœ‰è™Ÿæ•´æ•¸ æ˜¯ -1ï¼Œç•¶æˆ ç„¡è™Ÿæ•´æ•¸ æ˜¯ 4294967295
$s1 = 0000...0001 â†’ é€™å°±æ˜¯ 1

slt $t0, $s0, $s1  # signed
-1 < 1 âœ… æˆç«‹ â†’ $t0 = 1

sltu $t0, $s0, $s1  # unsigned
4294967295 > 1 âŒ ä¸æˆç«‹ â†’ $t0 = 0
```
## 9. procedure calling 
- Callerï¼ˆå‘¼å«è€…ï¼‰ï¼šæ˜¯å‘¼å«åˆ¥äººçš„ç¨‹å¼ï¼ˆèª°ä¸»å‹•å«åˆ¥äººä¾†åšäº‹ï¼‰
- Calleeï¼ˆè¢«å‘¼å«è€…ï¼‰ï¼šæ˜¯è¢«å‘¼å«åŸ·è¡Œçš„å­ç¨‹åºï¼ˆè¢«å«ä¾†å¹«å¿™åšäº‹ï¼‰
- æ­¥é©Ÿ
	- Place parameters in registersï¼ˆå°‡åƒæ•¸æ”¾å…¥æš«å­˜å™¨ï¼‰
		- æŠŠè¦å‚³çµ¦å­ç¨‹åºçš„åƒæ•¸æ”¾é€²ç‰¹å®šæš«å­˜å™¨ï¼ˆåƒæ˜¯ $a0~$a3ï¼‰
	- Transfer control to procedureï¼ˆè·³è½‰æ§åˆ¶æ¬Šï¼‰
		- ä½¿ç”¨ jalï¼ˆjump and linkï¼‰æŒ‡ä»¤è·³åˆ°å­ç¨‹åºä½ç½®
		- åŒæ™‚å„²å­˜è¿”å›ä½å€åœ¨ $raï¼ˆreturn addressï¼‰
	- Acquire storage for procedureï¼ˆé…ç½®å€åŸŸæš«å­˜ç©ºé–“ï¼‰
		- å­ç¨‹åºæœƒè‡ªå·±å»ºå †ç–Šç©ºé–“ï¼ˆstack frameï¼‰ä¿å­˜æš«å­˜å™¨å…§å®¹ï¼ˆä¾‹å¦‚ ra, s0~s7 ç­‰ï¼‰
	- Perform procedureâ€™s operationsï¼ˆåŸ·è¡Œå­ç¨‹åºçš„å…§å®¹ï¼‰
		- å­ç¨‹åºåšå®ƒçš„äº‹ï¼ˆé‹ç®—ã€é‚è¼¯è™•ç†ã€å­˜å–è¨˜æ†¶é«”...ï¼‰
	- Place result in register for callerï¼ˆæŠŠçµæœæ”¾åˆ°æš«å­˜å™¨ï¼‰
		- çµæœé€šå¸¸æ”¾åˆ° v0ï¼ˆæˆ– v1ï¼‰
	- Return to place of callï¼ˆè¿”å›å‘¼å«ä½ç½®ï¼‰
		- ç”¨ jr $ra å›åˆ°åŸæœ¬çš„å‘¼å«è™•ï¼ˆcallerï¼‰

```
# C
sum = f(a,b,c,d)

int f(g,h,i,j){
	int f;
	f = (g+h)-(i+j);
	return f;
}

Return addressï¼š$ra (return address)
Procedure addressï¼šLabels
Argumentsï¼š$a0, $al, $a2, $a3
Return valueï¼š$v0, $v1
Local variablesï¼š$s0, $s1, ... , $s7
```


![upgit_20250327_1743078825.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250327_1743078825.png)

```
# mips code
leaf_example:   # å‡½å¼çš„é–‹é ­æ¨™ç±¤åç¨±ï¼Œä»£è¡¨å¯ä»¥è¢« `jal` å‘¼å«çš„ç¨‹å¼æ®µè½

	##### æº–å‚™ç©ºé–“(å‚™ä»½) #####
	addi $sp, $sp, -4   # é–‹ä¸€å€‹å †ç–Šç©ºé–“ï¼ˆstack frameï¼‰ï¼Œå¾€ä¸‹ç§»å‹• 4 bytes
	sw   $s0, 0($sp)    # å°‡ $s0å­˜åˆ° stack ä¸Šï¼ˆé–‹å¥½ç©ºé–“å¾Œï¼Œå°‡å„²å­˜ï¼‰

	##### å¯¦éš›é‹ç®— #####
	add $t0, $a0, $a1   # t0 = a0 + a1
	add $t1, $a2, $a3   # t1 = a2 + a3
	sub $s0, $t0, $t1   # s0 = t0 - t1  â†’ æŠŠçµæœå­˜åˆ° s0ï¼ˆä¿å­˜çµæœï¼‰

	##### çµæœæ”¾å…¥ `$v0`ï¼ˆæº–å‚™å›å‚³ï¼‰ #####
	add $v0, $s0, $zero   # æŠŠ s0 è¤‡è£½åˆ° v0ï¼Œè¡¨ç¤º return çš„å€¼

	##### é‚„åŸä¹‹å‰ä¿è­·çš„ `$s0` #####
	lw   $s0, 0($sp)     # å¾ stack æŠŠåŸæœ¬çš„ $s0 å€¼æ‹¿å›ä¾†
	addi $sp, $sp, 4     # é‚„åŸ stack pointerï¼ˆé‡‹æ”¾ stack frameï¼‰

	##### å›å‚³åˆ°å‘¼å«è€…ï¼ˆCallerï¼‰#####
	jr $ra               # è·³å›åˆ°å‘¼å«é€™å€‹å‡½å¼çš„ä½ç½®
```

### 9.1. Local Data on the Stack
![upgit_20250327_1743080666.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250327_1743080666.png)

- spï¼ˆstack pointerï¼‰ï¼šæŒ‡å‘ç›®å‰ stack çš„åº•ç«¯ï¼ˆç©ºé–“æœ€ä¸‹é¢ï¼‰
- fpï¼ˆframe pointerï¼‰ï¼šå¯ä»¥ç•¶ä½œè©² function èµ·å§‹çš„åƒè€ƒé»ï¼ˆä¸æ˜¯ä¸€å®šç”¨ï¼‰
- ç•¶ç¨‹å¼åŸ·è¡Œå‘¼å«å‡½æ•¸ï¼š
	- Function å»ºç«‹è‡ªå·±çš„ Stack Frame
	- æŠŠä¸€äº›æ±è¥¿ push åˆ° stack ä¸Šï¼ˆstack å‘ä½åœ°å€å»¶ä¼¸ï¼‰
		- å‚³å…¥åƒæ•¸çš„æš«å­˜å™¨å€¼ï¼ˆ$a0~$a3ï¼‰
		- return addressï¼ˆ$raï¼‰
		- è¦ä¿å­˜çš„æš«å­˜å™¨ï¼ˆåƒ $s0~$s7ï¼‰
		- å€åŸŸè®Šæ•¸ç”¨çš„ç©ºé–“ï¼ˆä¾‹å¦‚ C çš„ `int x[10]`ï¼‰
- åŸ·è¡ŒçµæŸ â†’ stack è¢«å›æ”¶ï¼š
	- Callee çµæŸå¾Œï¼ŒæŠŠ $sp èª¿å›åŸä½ï¼ˆä¹Ÿå°±æ˜¯ free æ‰å‰›å‰›çš„ stack frameï¼‰
- local data allocated by callee
	- e.g. C è£¡é¢çš„ã€Œè‡ªå‹•è®Šæ•¸ã€ï¼ˆautomatic variablesï¼‰


## 10. memory layout
![upgit_20250327_1743082241.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250327_1743082241.png)

## 11. Byte / Halfword Operations
### 11.1. load byte signed/unsigned

![upgit_20250327_1743083822.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250327_1743083822.png)

## 12. 32-bit 

| æŒ‡ä»¤    | åŠŸèƒ½                        | å‚™è¨»                   |
| ----- | ------------------------- | -------------------- |
| `lw`  | Load Wordï¼ˆè¼‰å…¥ 4 bytesï¼‰     | 32-bit å°é½Š            |
| `sw`  | Store Wordï¼ˆå„²å­˜ 4 bytesï¼‰    |                      |
| `lh`  | Load Halfwordï¼ˆè¼‰å…¥ 2 bytesï¼‰ | **ç¬¦è™Ÿå»¶ä¼¸** sign-extend |
| `lhu` | Load Halfword Unsigned    | **é›¶å»¶ä¼¸** zero-extend  |
| `sh`  | Store Halfword            |                      |
| `lb`  | Load Byteï¼ˆè¼‰å…¥ 1 byteï¼‰      | **ç¬¦è™Ÿå»¶ä¼¸** sign-extend |
| `lbu` | Load Byte Unsigned        | **é›¶å»¶ä¼¸** zero-extend  |
| `sb`  | Store Byte                |                      |
| `lui` | Load Upper Immediate      | è¼‰å…¥é«˜ 16 ä½å…ƒï¼Œå·¦ç§» 16 bits |

```
load upper immediate
lui $rt, constant # å°‡16ä½å…ƒç§»åˆ°32ä½å…ƒçš„é«˜ä½å…ƒ
```
- MIPS çš„æŒ‡ä»¤æ ¼å¼ï¼ˆI-typeï¼‰åªæœ‰ 16-bit çš„ immediateï¼Œå¦‚æœæˆ‘å€‘è¦ä½¿ç”¨æˆ–çµ„å‡º 32-bit å¸¸æ•¸ï¼Œå°±å¿…é ˆ æ‹†æˆå…©éƒ¨åˆ†ä¾†åš
- ä½¿ç”¨ lui + ori çµ„åˆå…©æ®µç«‹å³å€¼
```
lui $s0, 61        # æŠŠå¸¸æ•¸ 61ï¼ˆå³ 0x003Dï¼‰æ”¾åˆ° $s0 çš„é«˜ 16 ä½å…ƒï¼Œä½ 16 ä½å…ƒæ¸…ç‚º 0
ori $s0, $s0, 2304 # æŠŠ $s0 çš„å€¼èˆ‡ 2304ï¼ˆå³ 0x0900ï¼‰åš ORï¼Œå°‡ ä½ 16 ä½å…ƒè£œä¸Š
```

```
##### ç¯„ä¾‹ #####
# éœ€æ±‚
addi $t0, $t0, 0xABABCDCD

# è§£æ³•
lui $t1, 0xABAB
ori $t1, $t1, 0xCDCD
add $t0, $t0, $t1
```


## 13. target address

![upgit_20250327_1743085505.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250327_1743085505.png)

## 14. translation & startup
![upgit_20250327_1743089428.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/03/upgit_20250327_1743089428.png)



- ç•¶ä½ ç”¨ Assemblerï¼ˆçµ„è­¯å™¨ï¼‰æˆ– Compilerï¼ˆç·¨è­¯å™¨ï¼‰ å°‡ç¨‹å¼ç¢¼è½‰æˆæ©Ÿå™¨ç¢¼æ™‚ï¼Œå®ƒæœƒç”¢ç”Ÿä¸€å€‹ã€Œç‰©ä»¶æª”ï¼ˆ`.o` æˆ– `.obj`ï¼‰ã€ï¼Œé€™å°±æ˜¯ Object Moduleã€‚

| å€å¡Šåç¨±                    | åŠŸèƒ½èªªæ˜                             |
| ----------------------- | -------------------------------- |
| **Header**              | æè¿°æ•´å€‹ç‰©ä»¶æ¨¡çµ„çš„å…§å®¹ã€çµæ§‹ï¼ˆmetadataï¼‰         |
| **Text segment**        | å·²ç¿»è­¯çš„ç¨‹å¼æŒ‡ä»¤ï¼ˆæ©Ÿå™¨ç¢¼ï¼‰                    |
| **Static data segment** | ç¨‹å¼ä¸­æœƒç”¨åˆ°çš„è³‡æ–™ï¼Œæ•´å€‹åŸ·è¡ŒæœŸé–“éƒ½æœƒå­˜åœ¨ï¼ˆä¾‹å¦‚ï¼šå…¨åŸŸè®Šæ•¸ã€å¸¸æ•¸ï¼‰ |
| **Relocation info**     | è¨˜éŒ„å“ªäº›ä½ç½®ä¹‹å¾Œè¦åœ¨é€£çµæ™‚åšåœ°å€ä¿®æ­£               |
| **Symbol table**        | ç´€éŒ„å…¨åŸŸè®Šæ•¸èˆ‡å¤–éƒ¨å‡½å¼çš„è³‡è¨Šï¼ˆæ–¹ä¾¿é€£çµå™¨æ‰¾äººï¼‰          |
| **Debug info**          | å¹«åŠ©é™¤éŒ¯å·¥å…·å°‡æ©Ÿå™¨ç¢¼å°æ‡‰å›åŸå§‹ç¨‹å¼ç¢¼               |

### 14.1. Linker çš„ä¸‰å¤§ä»»å‹™
- åˆä½µå„æ®µï¼ˆMerges segmentsï¼‰
	- æŠŠä¸åŒæ¨¡çµ„ä¸­çš„ text segmentã€data segment åˆä½µæˆä¸€å€‹å®Œæ•´çš„ç¨‹å¼ã€‚
- è§£ææ¨™ç±¤ï¼ˆResolve labelsï¼‰
	- æ‰¾å‡ºæ¯å€‹ç¬¦è™Ÿï¼ˆå¦‚å‡½å¼åã€è®Šæ•¸åï¼‰å°æ‡‰çš„è¨˜æ†¶é«”ä½å€ã€‚
- ä¿®è£œä½ç½®ç›¸ä¾æˆ–å¤–éƒ¨åƒè€ƒï¼ˆPatch location-dependent and external refsï¼‰
	- å¦‚æœæŸè¡Œç¨‹å¼ç¢¼æ˜¯è·³åˆ° mainã€å‘¼å«å¤–éƒ¨å‡½å¼ï¼ŒLinker æœƒæ›¿å®ƒè£œä¸Šæ­£ç¢ºåœ°å€ã€‚
- Relocation çš„æ„ç¾©ï¼šæœ‰äº›æŒ‡ä»¤çš„è·³èºã€å‡½å¼å‘¼å«æ˜¯ã€Œä½å€ä¾è³´çš„ã€ï¼Œéœ€è¦ Linker å¹«å¿™ä¿®æ­£ã€‚


### 14.2. ç¨‹å¼åŸ·è¡Œå‰ï¼Œç³»çµ±åšäº†ä»€éº¼æº–å‚™
- è®€å–åŸ·è¡Œæª”é ­ï¼ˆRead headerï¼‰
	- è§£æ image fileï¼ˆåŸ·è¡Œæª”æ ¼å¼ï¼Œå¦‚ ELFã€PEï¼‰
	- å¾—åˆ° text segmentã€data segment çš„å¤§å°èˆ‡ä½ç½®
- å»ºç«‹è™›æ“¬ä½å€ç©ºé–“ï¼ˆCreate virtual address spaceï¼‰
	- ç³»çµ±ç‚ºç¨‹å¼æº–å‚™ä¸€å¡Šä¹¾æ·¨çš„è™›æ“¬è¨˜æ†¶é«”ç©ºé–“
	- æ¯å€‹ç¨‹å¼çœ‹èµ·ä¾†éƒ½æœ‰è‡ªå·±çš„è¨˜æ†¶é«”ç©ºé–“ï¼ˆå³ä½¿å¯¦é«”ä¸Šå…±ç”¨ï¼‰
- å°‡ç¨‹å¼ç¢¼èˆ‡åˆå§‹åŒ–è³‡æ–™æ¬å…¥è¨˜æ†¶é«”ï¼ˆCopy text and initialized data into memoryï¼‰
	- æŠŠç¨‹å¼çš„ã€Œæ©Ÿå™¨ç¢¼æŒ‡ä»¤ã€å’Œã€Œåˆå§‹è³‡æ–™ï¼ˆå¦‚å…¨åŸŸè®Šæ•¸ï¼‰ã€æ¬é€²è¨˜æ†¶é«”
	- è£œå……ï¼šæˆ–æ˜¯å»ºç«‹ page tableï¼ˆåˆ†é è¡¨ï¼‰ï¼Œç­‰ä½¿ç”¨æ™‚å†åˆ†é è¼‰å…¥ï¼ˆlazy loadï¼‰
- è¨­ç½®ç¨‹å¼åƒæ•¸åœ¨ stack ä¸Šï¼ˆSet up arguments on stackï¼‰
	- æŠŠå‘½ä»¤åˆ—åƒæ•¸ï¼ˆå¦‚ main(int argc, char* argv[])ï¼‰æº–å‚™å¥½æ”¾åˆ° stack è£¡
- åˆå§‹åŒ–æš«å­˜å™¨ï¼ˆInitialize registersï¼‰
	- åŒ…æ‹¬ï¼š
		- $spï¼ˆstack pointerï¼‰ï¼šæŒ‡å‘å †ç–Šé ‚éƒ¨
		- $fpï¼ˆframe pointerï¼‰ï¼šç”¨æ–¼å‡½å¼å‘¼å«ç´€éŒ„
		- $gpï¼ˆglobal pointerï¼‰ï¼šå…¨åŸŸè³‡æ–™ä½å€åƒè€ƒç”¨
- è·³åˆ°å•Ÿå‹•ä¾‹ç¨‹ï¼ˆJump to startup routineï¼‰
	- åŸ·è¡Œç¨‹å¼çš„é–‹å ´ç™½ï¼ˆstartup codeï¼‰ï¼š
	- æŠŠåƒæ•¸å‚³åˆ° a0ã€a1 ç­‰æš«å­˜å™¨
	- å‘¼å« main()
	- ç­‰ main() çµæŸå¾ŒåŸ·è¡Œ exit ç³»çµ±å‘¼å«







### 14.3. Dynamic Linkingï¼ˆå‹•æ…‹é€£çµï¼‰
- ç¨‹å¼åœ¨åŸ·è¡Œï¼ˆrun timeï¼‰æ™‚æ‰å»è¼‰å…¥/é€£çµéœ€è¦çš„å‡½å¼åº«ï¼ˆlibraryï¼‰
	- åªæœ‰åœ¨çœŸæ­£ä½¿ç”¨æŸå€‹å‡½å¼æ™‚æ‰å»è¼‰å…¥å®ƒ
	- å‡½å¼ç¢¼è¦å¯ä»¥åœ¨ä»»æ„ä½å€åŸ·è¡Œï¼ˆæ”¯æ´è¨˜æ†¶é«”é‡å®šä½ï¼‰
	- éœæ…‹é€£çµæœƒæŠŠæ‰€æœ‰å‡½å¼åº«éƒ½åŒ…é€²å¯åŸ·è¡Œæª” â†’ é€ æˆæª”æ¡ˆè†¨è„¹ï¼›å‹•æ…‹é€£çµå‰‡èƒ½é¿å…è‚¥å¤§çš„åŸ·è¡Œæª”
	- å¦‚æœç³»çµ±æ›´æ–°äº†æŸå€‹å‡½å¼åº«ç‰ˆæœ¬ï¼Œç¨‹å¼æœƒè‡ªå‹•ä½¿ç”¨æ–°ç‰ˆ\
		- å¥½è™•ï¼šç¶­è­·å®¹æ˜“ã€ä¸éœ€é‡æ–°ç·¨è­¯
		- å£è™•ï¼šæ–°ç‰ˆä¸ç›¸å®¹å¯èƒ½æœƒå‡ºéŒ¯ï¼ˆé€™å°±æ˜¯ã€Œå‹•æ…‹åœ°ç„ã€ğŸ˜…ï¼‰

|é¡å‹|éœæ…‹é€£çµï¼ˆStatic Linkingï¼‰|å‹•æ…‹é€£çµï¼ˆDynamic Linkingï¼‰|
|---|---|---|
|é€£çµæ™‚é–“|ç·¨è­¯æ™‚å°±é€£çµ|åŸ·è¡Œæ™‚æ‰è¼‰å…¥|
|å‡½å¼åº«æ˜¯å¦æ‰“åŒ…|å‡½å¼åº«æœƒä¸€èµ·åŒ…é€²å¯åŸ·è¡Œæª”|å‡½å¼åº«æ˜¯å¤–éƒ¨æª”æ¡ˆï¼ˆå¦‚ `.so`, `.dll`ï¼‰|
|å¯åŸ·è¡Œæª”å¤§å°|è¼ƒå¤§|è¼ƒå°ï¼ˆå…±ç”¨å‡½å¼åº«ï¼‰|
|å½ˆæ€§|æ›´æ–°å‡½å¼åº«è¦é‡æ–°ç·¨è­¯|è‡ªå‹•æŠ“æ–°ç‰ˆå‡½å¼åº«|
## 15. Computer Arithmetic





